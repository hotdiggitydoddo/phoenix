<!DOCTYPE html>
<html>
<head>
    <title>SignalR Simple Chat</title>
    <link href="/Content/bootstrap.min.css" rel="stylesheet" />

    <style>
        #placeholder li {
            list-style: none;
            margin-left: 10px;
        }
    </style>
</head>
<body style="background: rgb(2, 2, 41)">
    <div class="container" style="margin-top: 30px;">
        <div class="jumbotron" style="background-color: #212542; border-color: #4b4b4b">
            <h1 class="text-center" style="color:aliceblue">SignalR Chat Test</h1>
            <input type="hidden" id="displayname" />
            <ul id="discussion"></ul>
            <div class="well" style="background-color: #353544; border-color: #44546D">
                <div id="placeholder" style="height: 200px; font-family: Courier; background-color: black; color:lightgray; overflow-y: scroll"></div>
                <br />
                <div>
                    <input type="text" class="form-control" id="message" style="background-color: black; border-color: #4B4B4B; color: lightgray; font-family: Courier;" />
                </div>
            </div>
        </div>
    </div>



    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="Scripts/jquery-2.1.3.min.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        function formatMsg(msg) {

        }


        var messageHistory = [];
        $(function () {
            $('#placeholder').scrollTop = $('#placeholder').scrollHeight;
            // Declare a proxy to reference the hub.
            var chat = $.connection.gameHub;
            // Create a function that the hub can call to broadcast messages.
            chat.client.broadcastMessage = function (name, message) {
                // Html encode display name and message.
                var encodedName = $('<div />').text(name).html();
                //var encodedMsg = $('<div />').text(message).html();
                var encodedMsg = $('<div />').html(message);

                // Add the message to the page.
                // debugger;
            //    $('#placeholder').append('<li><strong>' + encodedName
              //                      + '</strong>:&nbsp;&nbsp;' + message + '</li>');

                $('#placeholder').append('<li>' + message + '</li>');
                //debugger;
                //   $('#placeholder').animate({ scrollTop: $('#placeholder').scrollHeight }, "slow");
                $('#placeholder').animate({ "scrollTop": $('#placeholder')[0].scrollHeight }, "fast");
            };
            // Get the user name and store it to prepend to messages.

            $('#displayname').val(prompt('Enter your name:', ''));
            // Set initial focus to message input box.
            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {
                chat.server.send($("#displayname").val(), "|Connect");
                $('#message').keyup(function (e) {
                    e.preventDefault();
                    if (e.keyCode == 13) {
                        // Call the Send method on the hub.
                        chat.server.send($('#displayname').val(), $('#message').val());
                        // Clear text box and reset focus for next comment.
                        messageHistory.push($('#message').val());
                        $('#message').val('').focus();
                    } else if (e.keyCode == 38) {
                        $('#message').val(messageHistory.pop());
                    }

                });
            });
        });

        $(document).ready(function () {

        });
    </script>
</body>
</html>